#!/bin/bash
# batchProcessing-0x02
# Fetch data for multiple Pokémon with retry logic and error handling

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_BASE="https://pokeapi.co/api/v2/pokemon"
OUTPUT_DIR="pokemon_data"
ERROR_LOG="errors.txt"

mkdir -p "$OUTPUT_DIR"
: > "$ERROR_LOG"  # Clear old error log

for pokemon in "${POKEMONS[@]}"; do
    echo "Fetching data for $pokemon..."

    attempt=1
    success=false

    while [ $attempt -le 3 ]; do
        if curl -s -f "$API_BASE/$pokemon" -o "$OUTPUT_DIR/$pokemon.json"; then
            echo "Saved data to $OUTPUT_DIR/$pokemon.json ✅"
            success=true
            break
        else
            echo "Attempt $attempt failed for $pokemon. Retrying..."
            ((attempt++))
            sleep 2
        fi
    done

    if [ "$success" = false ]; then
        echo "[$(date)] Failed to fetch data for $pokemon after 3 attempts" >> "$ERROR_LOG"
        echo "Skipped $pokemon ❌"
    fi

    sleep 2  # General delay to avoid rate limiting
done
